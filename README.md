# Домашнее задание к занятию «Микросервисы: подходы»- Михалёв Сергей

Вы работаете в крупной компании, которая строит систему на основе микросервисной архитектуры.
Вам как DevOps-специалисту необходимо выдвинуть предложение по организации инфраструктуры для разработки и эксплуатации.

---

## Задача 1: Обеспечить разработку

Предложите решение для обеспечения процесса разработки: хранение исходного кода, непрерывная интеграция и непрерывная поставка. 
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- облачная система;
- система контроля версий Git;
- репозиторий на каждый сервис;
- запуск сборки по событию из системы контроля версий;
- запуск сборки по кнопке с указанием параметров;
- возможность привязать настройки к каждой сборке;
- возможность создания шаблонов для различных конфигураций сборок;
- возможность безопасного хранения секретных данных (пароли, ключи доступа);
- несколько конфигураций для сборки из одного репозитория;
- кастомные шаги при сборке;
- собственные докер-образы для сборки проектов;
- возможность развернуть агентов сборки на собственных серверах;
- возможность параллельного запуска нескольких сборок;
- возможность параллельного запуска тестов.

Обоснуйте свой выбор.

**Решение**

*GitLab CI/CD и GitHub Actions обеспечивают полную интеграцию с Git, гибкую настройку pipeline, безопасность данных и поддержку кастомных шагов и Docker-образов. Обе системы обладают мощными инструментами для CI/CD и поддерживают параллельные сборки.*

Обоснование:
- Запуск сборки по событию из системы контроля версий: *Поддерживаются триггеры сборок по событию (push, merge request).*
- Запуск сборки по кнопке с указанием параметров: *GitLab CI/CD позволяет настраивать pipeline с параметрами запуска, как и GitHub Actions.*
- Привязка настроек к каждой сборке: *Настройка происходит через YAML-файл в репозитории, где можно привязать конфигурации к каждой сборке.*
- Создание шаблонов для различных конфигураций сборок: *Оба инструмента поддерживают многоразовые шаблоны для разных конфигураций.*
- Безопасное хранение секретных данных: *Для хранения секретных данных можно использовать встроенные механизмы GitLab Secrets или GitHub Secrets.*
- Несколько конфигураций для сборки из одного репозитория: *YAML-файлы позволяют определять различные конфигурации для одной сборки.*
- Кастомные шаги при сборке: *Полная настройка этапов CI/CD через скрипты в YAML.*
- Собственные Docker-образы для сборки: *Можно создавать и использовать свои Docker-образы.*
- Развертывание агентов сборки на собственных серверах: *В GitLab CI/CD можно развернуть runners на своих серверах, аналогично в GitHub Actions через self-hosted runners.*
- Параллельный запуск нескольких сборок и тестов: *Оба решения поддерживают параллелизацию задач и тестов.*

*На практике использую GitHub Actions, но подумываю о переходе на GitLab,  потому и привёл оба варианта.*

---

## Задача 2: Логи

Предложите решение для обеспечения сбора и анализа логов сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор логов в центральное хранилище со всех хостов, обслуживающих систему;
- минимальные требования к приложениям, сбор логов из stdout;
- гарантированная доставка логов до центрального хранилища;
- обеспечение поиска и фильтрации по записям логов;
- обеспечение пользовательского интерфейса с возможностью предоставления доступа разработчикам для поиска по записям логов;
- возможность дать ссылку на сохранённый поиск по записям логов.

Обоснуйте свой выбор.

**Решение**

*Для сбора и анализа логов в микросервисной архитектуре предлагаю использовать стек ELK. Существует ещё аналог- EFK (Elasticsearch, Fluentd, Kibana).*

Обоснование:

- Сбор логов в центральное хранилище: *Logstash или Fluentd собирают логи со всех хостов и отправляют их в Elasticsearch.*
- Минимальные требования к приложениям: *Logstash и Fluentd могут собирать логи напрямую из stdout.*
- Гарантированная доставка логов: *Fluentd и Logstash поддерживают буферизацию данных, обеспечивая доставку даже при временной недоступности Elasticsearch.*
- Поиск и фильтрация: *Elasticsearch предоставляет мощные инструменты для полнотекстового поиска и фильтрации логов.*
- Пользовательский интерфейс для доступа к логам: *Kibana предлагает удобный UI для поиска и анализа логов.*
- Ссылки на сохранённые поиски: *Kibana позволяет сохранять и делиться ссылками на результаты поиска.*

---

## Задача 3: Мониторинг

Предложите решение для обеспечения сбора и анализа состояния хостов и сервисов в микросервисной архитектуре.
Решение может состоять из одного или нескольких программных продуктов и должно описывать способы и принципы их взаимодействия.

Решение должно соответствовать следующим требованиям:
- сбор метрик со всех хостов, обслуживающих систему;
- сбор метрик состояния ресурсов хостов: CPU, RAM, HDD, Network;
- сбор метрик потребляемых ресурсов для каждого сервиса: CPU, RAM, HDD, Network;
- сбор метрик, специфичных для каждого сервиса;
- пользовательский интерфейс с возможностью делать запросы и агрегировать информацию;
- пользовательский интерфейс с возможностью настраивать различные панели для отслеживания состояния системы.

Обоснуйте свой выбор.

**Решение**

*Для мониторинга хостов и сервисов предлагаю использовать связку Prometheus + Grafana как наиболее популярное и масштабируемое решение, хотя и Zabbix тоже не плох.*

Обоснование:

- Сбор метрик со всех хостов: *Prometheus использует pull-модель, собирая метрики с агентов, развернутых на каждом хосте (например, node_exporter для хостов и custom exporters для сервисов).*
- Сбор метрик состояния ресурсов хостов: *node_exporter собирает метрики по CPU, RAM, диску и сети.*
- Сбор метрик для каждого сервиса: *Prometheus можно настроить для сбора специфичных метрик для каждого сервиса с помощью экспортеров или встроенных метрик.*
- Интерфейс с запросами и агрегированием: *Grafana предоставляет мощный интерфейс для запросов и визуализации данных.*
- Настройка панелей для отслеживания системы: *В Grafana можно создать кастомные панели для мониторинга различных аспектов работы системы, в том числе метрик хостов и сервисов.*

